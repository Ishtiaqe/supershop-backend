generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String             @id @default(uuid())
  email             String             @unique
  password          String
  fullName          String
  phone             String?
  role              UserRole           @default(EMPLOYEE)
  tenantId          String?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt
  pushSubscriptions PushSubscription[]
  refreshTokens     RefreshToken[]
  sales             Sale[]
  tenant            Tenant?            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([tenantId])
  @@map("users")
}

model RefreshToken {
  id        String   @id @default(uuid())
  token     String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@map("refresh_tokens")
}

model PushSubscription {
  id        String   @id @default(uuid())
  userId    String
  endpoint  String   @unique
  keys      Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("push_subscriptions")
}

model Tenant {
  id                 String           @id @default(uuid())
  name               String
  registrationNumber String?          @unique
  addressStreet      String?
  addressCity        String?
  addressZone        String?
  latitude           Float?
  longitude          Float?
  status             TenantStatus     @default(ACTIVE)
  preferences        Json?
  theme              Json?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  brands             Brand[]
  categories         Category[]
  inventoryItems     InventoryItem[]
  productVariants    ProductVariant[]
  products           Product[]
  restockReceipts    RestockReceipt[]
  sales              Sale[]
  suppliers          Supplier[]
  users              User[]

  @@index([status])
  @@map("tenants")
}

model Category {
  id        String    @id @default(uuid())
  name      String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  tenantId  String
  tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  products  Product[]

  @@unique([name, tenantId])
  @@index([tenantId])
  @@map("categories")
}

model Brand {
  id        String    @id @default(uuid())
  name      String
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  tenantId  String
  tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  products  Product[]

  @@unique([name, tenantId])
  @@index([tenantId])
  @@map("brands")
}

model Supplier {
  id              String           @id @default(uuid())
  name            String
  contactPerson   String?
  phone           String?
  email           String?
  address         String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  tenantId        String
  restockReceipts RestockReceipt[]
  tenant          Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@map("suppliers")
}

model Product {
  id               String           @id @default(uuid())
  name             String
  description      String?
  brandId          String?
  categoryId       String?
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  genericName      String?
  manufacturerName String?
  productType      ProductType      @default(GENERAL)
  tenantId         String
  variants         ProductVariant[]
  brand            Brand?           @relation(fields: [brandId], references: [id])
  category         Category?        @relation(fields: [categoryId], references: [id])
  tenant           Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([name])
  @@index([brandId])
  @@index([categoryId])
  @@index([productType])
  @@map("products")
}

model ProductVariant {
  id             String          @id @default(uuid())
  productId      String
  variantName    String
  sku            String
  retailPrice    Float
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  tenantId       String
  inventoryItems InventoryItem[]
  product        Product         @relation(fields: [productId], references: [id], onDelete: Cascade)
  tenant         Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([sku, tenantId])
  @@index([tenantId])
  @@index([productId])
  @@map("product_variants")
}

model InventoryItem {
  id              String          @id @default(uuid())
  tenantId        String
  variantId       String?
  itemName        String?
  quantity        Int             @default(0)
  purchasePrice   Float
  retailPrice     Float
  maxDiscountRate Float           @default(0)
  expiryDate      DateTime?
  mfgDate         DateTime?
  batchNo         String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  tenant          Tenant          @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  variant         ProductVariant? @relation(fields: [variantId], references: [id])
  saleItems       SaleItem[]

  @@index([tenantId])
  @@index([variantId])
  @@index([expiryDate])
  @@index([quantity])
  @@map("inventory_items")
}

model RestockReceipt {
  id            String    @id @default(uuid())
  tenantId      String
  receiptNumber String
  supplierId    String?
  notes         String?
  createdAt     DateTime  @default(now())
  supplier      Supplier? @relation(fields: [supplierId], references: [id])
  tenant        Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([receiptNumber])
  @@map("restock_receipts")
}

model Sale {
  id            String        @id @default(uuid())
  tenantId      String
  employeeId    String
  receiptNumber String        @unique
  saleTime      DateTime      @default(now())
  totalAmount   Float
  totalProfit   Float
  customerName  String?
  customerPhone String?
  saleType      SaleType      @default(POS)
  paymentMethod PaymentMethod @default(CASH)
  discountType  DiscountType?
  discountValue Float?        @default(0)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  items         SaleItem[]
  employee      User          @relation(fields: [employeeId], references: [id])
  tenant        Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([saleTime])
  @@index([receiptNumber])
  @@map("sales")
}

model SaleItem {
  id          String        @id @default(uuid())
  saleId      String
  inventoryId String
  quantity    Int
  unitPrice   Float
  subtotal    Float
  createdAt   DateTime      @default(now())
  discount    Float         @default(0)
  inventory   InventoryItem @relation(fields: [inventoryId], references: [id])
  sale        Sale          @relation(fields: [saleId], references: [id], onDelete: Cascade)

  @@index([saleId])
  @@index([inventoryId])
  @@map("sale_items")
}

model MedicineGeneric {
  id                               String              @id @default(uuid())
  genericId                        Int?                @unique
  genericName                      String
  slug                             String
  monographLink                    String?
  indicationDescription            String?
  therapeuticClassDescription      String?
  pharmacologyDescription          String?
  dosageDescription                String?
  administrationDescription        String?
  interactionDescription           String?
  contraindicationsDescription     String?
  sideEffectsDescription           String?
  pregnancyAndLactationDescription String?
  precautionsDescription           String?
  pediatricUsageDescription        String?
  overdoseEffectsDescription       String?
  durationOfTreatmentDescription   String?
  reconstitutionDescription        String?
  storageConditionsDescription     String?
  descriptionsCount                Int
  createdAt                        DateTime            @default(now())
  updatedAt                        DateTime            @updatedAt
  drugClassId                      String?
  indicationId                     String?
  drugClass                        MedicineDrugClass?  @relation(fields: [drugClassId], references: [id])
  indication                       MedicineIndication? @relation(fields: [indicationId], references: [id])
  medicines                        Medicine[]

  @@index([genericName])
  @@map("medicine_generics")
}

model Medicine {
  id               String                @id @default(uuid())
  brandId          Int?                  @unique
  brandName        String
  type             String
  slug             String
  dosageForm       String?
  strength         String?
  packageContainer String?
  packSizeInfo     String?
  createdAt        DateTime              @default(now())
  updatedAt        DateTime              @updatedAt
  genericId        String?
  manufacturerId   String?
  generic          MedicineGeneric?      @relation(fields: [genericId], references: [id])
  manufacturer     MedicineManufacturer? @relation(fields: [manufacturerId], references: [id])

  @@index([brandName])
  @@index([genericId])
  @@index([manufacturerId])
  @@map("medicines")
}

model MedicineManufacturer {
  id               String     @id @default(uuid())
  manufacturerId   Int?       @unique
  manufacturerName String
  slug             String
  genericsCount    Int?
  brandNamesCount  Int?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt
  medicines        Medicine[]

  @@index([manufacturerName])
  @@map("medicine_manufacturers")
}

model MedicineDrugClass {
  id            String            @id @default(uuid())
  drugClassId   Int?              @unique
  drugClassName String
  slug          String
  genericsCount Int?
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  generics      MedicineGeneric[]

  @@index([drugClassName])
  @@map("medicine_drug_classes")
}

model MedicineIndication {
  id             String            @id @default(uuid())
  indicationId   Int?              @unique
  indicationName String
  slug           String
  genericsCount  Int?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  generics       MedicineGeneric[]

  @@index([indicationName])
  @@map("medicine_indications")
}

model MedicineDosageForm {
  id              String   @id @default(uuid())
  dosageFormId    Int?     @unique
  dosageFormName  String
  slug            String
  brandNamesCount Int?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([dosageFormName])
  @@map("medicine_dosage_forms")
}

enum UserRole {
  SUPER_ADMIN
  OWNER
  EMPLOYEE
}

enum TenantStatus {
  ACTIVE
  SUSPENDED
  INACTIVE
}

enum SaleType {
  POS
  ONLINE
  WHOLESALE
}

enum PaymentMethod {
  CASH
  CARD
  MOBILE_PAYMENT
  OTHER
}

enum DiscountType {
  PERCENTAGE
  FIXED
}

enum ProductType {
  GENERAL
  MEDICINE
}
